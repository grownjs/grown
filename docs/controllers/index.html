<!DOCTYPE html><html><head><base href="/"><meta lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="HandheldFriendly" content="true"><meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no"><!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><script src="//css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script><![endif]--><title>FTW</title><link rel="stylesheet" href="styles.css"><style>pre { overflow:auto }</style></head><body><main style="margin-left:20em;"><h3 id="controllers">Controllers</h3>
<p>Routes are the way to go, then you can take control.</p>
<h4 id="routing">Routing</h4>
<p>Route mappings are defined in the <code>config/routes.js</code> file:</p>
<pre><code class="lang-js">module.exports = map =&gt;
  map()
    .get(&#39;/&#39;, &#39;Home#index&#39;, { as: &#39;root&#39; });
</code></pre>
<p>Each time you call a <code>map()</code> factory you can pass values and they will be inherited down.</p>
<h4 id="definition">Definition</h4>
<p>Controllers can be plain-old javascript objects.</p>
<pre><code class="lang-js">// app/controllers/Home.js

module.exports = {
  methods: {
    index() {}
  },
};
</code></pre>
<p>By the mere fact of being declared, the render plug will try to render a <code>Home/index</code> view.</p>
<h4 id="end-responses">End responses</h4>
<p>Any method receives the connection object, in turn it can responds or return a string,
buffer, stream or promise:</p>
<pre><code class="lang-js">index(conn) {
  conn.resp_body = &#39;42&#39;;
  // return &#39;42&#39;;
  // return new Buffer(&#39;42&#39;);
  // return Promise.resolve(&#39;42&#39;);
  // return conn.end(&#39;42&#39;).then(...);
}
</code></pre>
<p>Call <code>put_status()</code> to set a proper status code:</p>
<pre><code class="lang-js">conn.put_status(400);
conn.resp_body = {
  status: &#39;error&#39;,
  message: &#39;Invalid input&#39;,
};
</code></pre>
<h4 id="testing-actions">Testing actions</h4>
<p>Doing assertions on your controllers&#39; responses is easy peasy.</p>
<pre><code class="lang-coffee"># spec/pages-spec.coffee

app = require(&#39;../app/server&#39;)
Grown = require(&#39;grown&#39;)

describe &#39;web pages&#39;, -&gt;
  beforeEach Grown.test(app)

  it &#39;not all pages exists&#39;, (done) -&gt;
    @server.fetch(&#39;/x&#39;).then (resp) -&gt;
      expect(resp.body).toContain(&#39;Not Found&#39;)
      done()

  it &#39;but the homepage yes!&#39;, (done) -&gt;
    @server.fetch(&#39;/&#39;).then (resp) -&gt;
      expect(resp.body).toContain(&#39;It works!&#39;)
      done()
</code></pre>
<p>Run your tests with <code>yarn spec</code> or <code>npm run spec</code> and see the results.</p>
<h4 id="interactive-mode-fetch">Interactive mode (fetch)</h4>
<p>On the REPL you can <code>.fetch</code> resources too.</p>
<p>Examples:</p>
<pre><code class="lang-bash">.fetch POST /account --json username=foo
.fetch destroyAccount
.fetch showLogin
.fetch ...
</code></pre>
<p>To list all available routes just type <code>.routes</code> and hit ENTER.</p>
<p>Try <code>.routes &lt;something&gt;</code> to filter out matching routes.</p>
<ul>
<li><a href="/">back</a></li>
<li><a href="/docs/models">next</a></li>
</ul>
</main><aside style="position:fixed;bottom:0;top:0;max-width:20em;overflow:auto;"><ul><li><a href="/">home</a></li><li><a href="/docs">docs</a><ul><li><a href="/docs/initialization">Initialization</a></li><li><a href="/docs/interactive-mode">Interactive mode</a></li><li><strong><a class="here" href="/docs/controllers">Controllers</a></strong><ul><li><a href="/docs/controllers#routing">Routing</a></li><li><a href="/docs/controllers#definition">Definition</a></li><li><a href="/docs/controllers#end-responses">End responses</a></li><li><a href="/docs/controllers#testing-actions">Testing actions</a></li><li><a href="/docs/controllers#interactive-mode-fetch">Interactive mode (fetch)</a></li></ul></li><li><a href="/docs/models">Models</a><ul><li><a href="/docs/models#json-schema">JSON-Schema</a></li><li><a href="/docs/models#model-syncing">Model syncing</a></li><li><a href="/docs/models#testing-models">Testing models</a></li><li><a href="/docs/models#interactive-mode-models">Interactive mode (models)</a></li></ul></li><li><a href="/docs/views">Views</a><ul><li><a href="/docs/views#functions-as-templates">Functions as templates</a></li><li><a href="/docs/views#pre-compiled-templates">Pre-compiled templates</a></li><li><a href="/docs/views#layouts-blocks">Layouts &amp; blocks</a></li><li><a href="/docs/views#testing-views">Testing views</a></li><li><a href="/docs/views#interactive-mode-render">Interactive mode (render)</a></li></ul></li><li><a href="/docs/booting">Booting</a><ul><li><a href="/docs/booting#server">Server</a></li><li><a href="/docs/booting#api">API</a></li><li><a href="/docs/booting#hooks">Hooks</a></li><li><a href="/docs/booting#plugins">Plugins</a></li><li><a href="/docs/booting#middlewares">Middlewares</a></li><li><a href="/docs/booting#testing-the-app">Testing the app</a></li><li><a href="/docs/booting#interactive-mode-reload">Interactive mode (reload)</a></li></ul></li><li><a href="/docs/assets">Assets</a><ul><li><a href="/docs/assets#static-files">Static files</a></li><li><a href="/docs/assets#javascripts">Javascripts</a></li><li><a href="/docs/assets#stylesheets">Stylesheets</a></li><li><a href="/docs/assets#images-sprites">Images &amp; Sprites</a></li><li><a href="/docs/assets#templating-views">Templating (views)</a></li></ul></li></ul></li></ul></aside></body></html>