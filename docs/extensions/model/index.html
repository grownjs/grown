<!DOCTYPE html>
<html>
  <head>
    <base href="/">
    <meta lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no"><!--[if lt IE 9]>
    <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <script src="https://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script><![endif]-->
    <title>Grown // Model (#ccb9f59)</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/highlight.js/styles/default.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sorts+Mill+Goudy">
  </head>
  <body class="reset">
    <div id="wrapper">
      <div class="body" id="content">
        <main><a id="menu" href="/docs/extensions/model/#sidebar">&#9776;</a>
          <h1>Model <small><a href="//github.com/grownjs/jamming/blob/master/src/pages/docs/extensions/model.md" target="_blank">&#9998;</a></small></h1><p>Declare and validate your models using JSON-Schema definitions.</p>
<pre class="hljs"><code class="lang-js"><span class="hljs-comment">/* @runkit */</span>
<span class="hljs-comment">// register extension</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = <span class="hljs-title class_">Grown</span>.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@grown/model&#x27;</span>));

<span class="hljs-comment">// declares a single entity model</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Example</span> = <span class="hljs-title class_">Model</span>.<span class="hljs-property">Entity</span>.<span class="hljs-title function_">define</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, {
  <span class="hljs-attr">$schema</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;TestExample&#x27;</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;object&#x27;</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">value</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>,
      },
    },
  },
});

<span class="hljs-comment">// connect database for this model only</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ExampleModel</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Example</span>.<span class="hljs-title function_">connect</span>({
  <span class="hljs-attr">dialect</span>: <span class="hljs-string">&#x27;sqlite&#x27;</span>,
  <span class="hljs-attr">storage</span>: <span class="hljs-string">&#x27;:memory:&#x27;</span>,
});

<span class="hljs-comment">// direct access to your sequelize-models</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">ExampleModel</span>.<span class="hljs-title function_">sync</span>();
<span class="hljs-keyword">await</span> <span class="hljs-title class_">ExampleModel</span>.<span class="hljs-title function_">count</span>();
</code></pre>
<p>Repositories are built by scanning source files in any given directory, e.g.</p>
<pre class="hljs"><code class="lang-js"><span class="hljs-comment">/* @runkit */</span>
<span class="hljs-comment">// register extension</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = <span class="hljs-title class_">Grown</span>.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@grown/model&#x27;</span>));

<span class="hljs-comment">// ./models/Test/index.js</span>
<span class="hljs-comment">// module.exports = {</span>
<span class="hljs-comment">//   $schema: require(&#x27;./schema&#x27;)</span>
<span class="hljs-comment">// };</span>

<span class="hljs-comment">// ./models/Test/schema.json</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   &quot;id&quot;: &quot;TestModel&quot;,</span>
<span class="hljs-comment">//   &quot;type&quot;: &quot;object&quot;,</span>
<span class="hljs-comment">//   &quot;properties&quot;: {</span>
<span class="hljs-comment">//     &quot;value&quot;: {</span>
<span class="hljs-comment">//       &quot;type&quot;: &quot;string&quot;</span>
<span class="hljs-comment">//     }</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// scan for all model definitions within</span>
<span class="hljs-keyword">const</span> repo = <span class="hljs-title class_">Grown</span>.<span class="hljs-property">Model</span>.<span class="hljs-property">DB</span>.<span class="hljs-title function_">bundle</span>({
  <span class="hljs-attr">models</span>: <span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/models`</span>,
  <span class="hljs-attr">database</span>: {
    <span class="hljs-attr">identifier</span>: <span class="hljs-string">&#x27;test&#x27;</span>,
    <span class="hljs-attr">config</span>: {
      <span class="hljs-attr">dialect</span>: <span class="hljs-string">&#x27;sqlite&#x27;</span>,
      <span class="hljs-attr">storage</span>: <span class="hljs-string">&#x27;:memory:&#x27;</span>
    }
  }
});

<span class="hljs-comment">// expose RESTful endpoint to your models</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API</span> = <span class="hljs-title class_">Grown</span>.<span class="hljs-property">Model</span>.<span class="hljs-title class_">Formator</span>({
  <span class="hljs-attr">database</span>: <span class="hljs-title class_">Grown</span>.<span class="hljs-property">Model</span>.<span class="hljs-property">DB</span>.<span class="hljs-property">test</span>,
  <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/db&#x27;</span>,
});

<span class="hljs-comment">// connect the repository</span>
<span class="hljs-keyword">await</span> repo.<span class="hljs-title function_">connect</span>();
<span class="hljs-keyword">await</span> repo.<span class="hljs-title function_">sync</span>();

<span class="hljs-comment">// access model as a RESTful resource</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">TestRepo</span> = <span class="hljs-variable constant_">API</span>.<span class="hljs-title function_">from</span>(repo.<span class="hljs-property">models</span>.<span class="hljs-property">ExampleModel</span>);
<span class="hljs-keyword">const</span> testCount = <span class="hljs-keyword">await</span> <span class="hljs-title class_">TestRepo</span>.<span class="hljs-title function_">count</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(testCount);

<span class="hljs-comment">// close connection</span>
<span class="hljs-keyword">await</span> repo.<span class="hljs-title function_">disconnect</span>();
</code></pre>
<p>In the example above we&#39;re using <code>API</code> as our RESTful adapter, we can also <code>plug()</code> it in our server application, e.g. <code>server.plug(API)</code> &mdash; that would mount the <code>/db</code> endpoint.</p>
<blockquote>
<p>Repos are built using <a href="https://github.com/tacoss/sastre"><code>sastre</code></a> &mdash; check it out for further info.</p>
</blockquote>
<h2 id="cli">CLI</h2>
<h3 id="public-methods-var-static-var">Public methods <var>static</var></h3>
<ul>
<li><code>usage(bin)</code> &mdash; Prints out the usage info for the given binary.</li>
<li><code>execute(db, cmd, argv)</code> &mdash; Run the given <code>cmd</code> and <code>argv</code> through the given <code>db</code> connection.</li>
</ul>
<blockquote>
<p>See <a href="https://github.com/json-schema-faker/json-schema-sequelizer">json-schema-sequelizer</a> for usage info.</p>
</blockquote>
<h2 id="db">DB</h2>
<h3 id="public-methods-var-static-var">Public methods <var>static</var></h3>
<ul>
<li><code>registered(name)</code> &mdash; Returns <code>true</code> if the named connection is already defined.</li>
<li><code>register(name, params)</code> &mdash; Add a named connection to the registry where params is an object with <code>config</code>, <code>refs</code> and <code>cwd</code> options.</li>
<li><code>bundle(options)</code> &mdash; Returns a repository built on top of given <code>models</code> directory and <code>database</code> options as connection.</li>
</ul>
<blockquote>
<p>Repos has the following methods/props: <code>disconnect()</code>, <code>connect()</code>, <code>sync()</code>, <code>get(model)</code>, <code>connection</code>, <code>sequelize</code>, <code>schemas</code>, <code>models</code> and <code>$refs</code>.</p>
</blockquote>
<h3 id="private-props-var-static-var">Private* props <var>static</var></h3>
<ul>
<li><code>_registry</code> &mdash; All registered database connections.</li>
</ul>
<h2 id="entity">Entity</h2>
<h3 id="public-methods-var-static-var">Public methods <var>static</var></h3>
<ul>
<li><code>define(name, params)</code> &mdash; Returns a new <code>Entity</code> model from the given <code>name</code> and <code>params</code> arguments.</li>
<li><code>connect(options[, refs, cwd])</code> &mdash; Set the connection for the given options; <code>refs</code> and <code>cwd</code> are for dereferencing.</li>
<li><code>getSchema(id[, refs])</code> &mdash; Returns the wrapped schema, given <code>id</code> is lookup through <code>definitions</code> schemas; <code>refs</code> are optional schemas.</li>
</ul>
<h3 id="private-methods-var-static-var">Private* methods <var>static</var></h3>
<ul>
<li><code>_validateFrom(id, ref, refs, data)</code> &mdash; Returns a promise with the validation results from calling <code>_assertFrom(...)</code>.</li>
<li><code>_assertFrom(id, ref, refs, data)</code> &mdash; Retrieve the named schema by <code>ìd</code> and validates the given <code>data</code> input; <code>ref</code> and <code>refs</code> are optional.</li>
<li><code>_fakeFrom(id, refs, opts)</code> &mdash; Generates examples based on the json-schema found by <code>id</code>-</li>
<li><code>_through(id, refs)</code> &mdash; Used to resolve from <code>definitions</code> returning the same methods as <code>_schema(...)</code>.</li>
<li><code>_schema(id, refs)</code> &mdash; Used to resove from regular schemas; returns <code>fakeOne</code>, <code>fakeMany</code>, <code>assert</code>, and <code>validate</code> methods.</li>
<li><code>_wrap(id, def[, refs])</code> &mdash; Use to decorate any given model with the <code>getSchema(...)</code> method, only if is not present already.</li>
</ul>
<blockquote>
<p>See <a href="https://json-schema-faker.js.org/">json-schema-faker</a> for usage info.</p>
</blockquote>
<h2 id="formator">Formator</h2>
<h3 id="public-methods-var-static-var">Public methods <var>static</var></h3>
<ul>
<li><code>$install(ctx)</code> &mdash; Auto-mount endpoint for general usage; requires <code>prefix</code>, <code>database</code> and <code>options</code> to be defined.</li>
<li><code>from(Model, params, options)</code> &mdash; Returns a RESTful resource for the given model; requires <code>database</code> to be defined.</li>
</ul>
<blockquote>
<p>RESTful resources have six methods only: <code>findAll</code>, <code>findOne</code>, <code>destroy</code>, <code>update</code>, <code>count</code> and <code>create</code>.</p>
<p>See <a href="https://github.com/pateketrueke/formator">formator</a> for usage info.</p>
</blockquote>
<hr>
<p>➯ Next: <a href="./docs/extensions/render">Extensions &rangle; Render</a></p>

        </main>
      </div>
      <aside class="inverted" id="sidebar">
        <div class="body">
          <h1>
            <a href=".">Grown</a>
          </h1>
          <p>Experimental DSL for web-apps</p>
          <div class="sp"><a href="http://badge.fury.io/js/grown" target="_blank"><img src="//badge.fury.io/js/grown.svg"></a><a href="//codecov.io/gh/grownjs/grown" target="_blank"><img src="//codecov.io/gh/grownjs/grown/branch/master/graph/badge.svg"></a><a href="//github.com/grownjs/grown/actions" target="_blank"><img src="//github.com/grownjs/grown/workflows/build/badge.svg"></a></div>
          <ul class="mt reset">
            <li>
              <h3 class="reset">APIs</h3>
              <ul class="pl reset">
                <li>
                  <a href=".">Installation</a>
                </li>
                <li>
                  <a exact="true" href="./docs">The interface</a>
                </li>
                <li>
                  <a href="./docs/command-line">Command line</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Add-ons</h3>
              <ul class="pl reset">
                <li>
                  <a aria-current="page" href="./docs/extensions">Extensions</a>
                  <ul class="pl reset">
                    <li>
                      <a href="./docs/extensions/access">Access</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/bud">Bud</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/cli">CLI</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/conn">Conn</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/graphql">GraphQL</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/grpc">GRPC</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/logger">Logger</a>
                    </li>
                    <li>
                      <a aria-current="page" href="./docs/extensions/model">Model</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/render">Render</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/repl">REPL</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/router">Router</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/server">Server</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/session">Session</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/static">Static</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/test">Test</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/upload">Upload</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="./docs/connection">Connection</a>
                </li>
                <li>
                  <a href="./docs/middlewares">Middlewares</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Data-layer</h3>
              <ul class="pl reset">
                <li>
                  <a href="./docs/database">Models</a>
                </li>
                <li>
                  <a href="./docs/validation">Schemas</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Controllers</h3>
              <ul class="pl reset">
                <li>
                  <a href="./docs/controllers">Web</a>
                </li>
                <li>
                  <a href="./docs/controllers/grpc">GRPC</a>
                </li>
                <li>
                  <a href="./docs/controllers/graphql">GraphQL</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Unit-testing</h3>
              <ul class="pl reset">
                <li>
                  <a href="./docs/testing">Server</a>
                </li>
                <li>
                  <a href="./docs/testing/schema">Schema</a>
                </li>
                <li>
                  <a href="./docs/testing/handlers">Handlers</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </aside>
    </div>
    <script>window.__runkit__ = {"preamble":{"contents":"require('sqlite3');\n\nconst fs = require('fs');\n\nfs.mkdirSync('./models');\nfs.mkdirSync('./models/Test');\nfs.writeFileSync('./models/Test/schema.json', `{\n  \"id\": \"ExampleModel\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"value\": {\n      \"type\": \"string\"\n    }\n  }\n}`);\n\nfs.writeFileSync('./models/Test/index.js', `\n  module.exports = {\n    $schema: require('./schema')\n  };\n`);\n\nconst Grown = require('@grown/bud')();\n\nGrown.use(require('@grown/server'));\n\nconst server = new Grown(); // eslint-disable-line\n"}};</script>
    <script src="//embed.runkit.com"></script>
    <script src="scripts.js"></script>
  </body>
</html>