<!DOCTYPE html>
<html>
  <head>
    <base href="/">
    <meta lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no"><!--[if lt IE 9]>
    <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <script src="https://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script><![endif]-->
    <title>Grown // CLI (#ccb9f59)</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/highlight.js/styles/default.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sorts+Mill+Goudy">
  </head>
  <body class="reset">
    <div id="wrapper">
      <div class="body" id="content">
        <main><a id="menu" href="/docs/extensions/cli/#sidebar">&#9776;</a>
          <h1>CLI <small><a href="//github.com/grownjs/jamming/blob/master/src/pages/docs/extensions/cli.md" target="_blank">&#9998;</a></small></h1><p>Manage your database setup, start or interact with your application, etc.</p>
<pre class="hljs"><code class="lang-js"><span class="hljs-comment">/* @runkit */</span>
<span class="hljs-comment">// require and create a Grown-container</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Grown</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@grown/bud&#x27;</span>)();

<span class="hljs-comment">// register extension</span>
<span class="hljs-title class_">Grown</span>.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@grown/cli&#x27;</span>));

<span class="hljs-comment">// overload definition</span>
<span class="hljs-title class_">Grown</span>(<span class="hljs-string">&#x27;CLI&#x27;</span>, {
  <span class="hljs-attr">task_folders</span>: [
    <span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/tasks`</span>,
  ],
});

<span class="hljs-comment">// e.g. ./tasks/example.js</span>
<span class="hljs-comment">// module.exports = {</span>
<span class="hljs-comment">//   description: &#x27;Example task&#x27;,</span>
<span class="hljs-comment">//   callback() {</span>
<span class="hljs-comment">//     console.log(&#x27;It works.&#x27;)</span>
<span class="hljs-comment">//   },</span>
<span class="hljs-comment">// };</span>

<span class="hljs-comment">// e.g. `node script.js example -- ls tasks`</span>
<span class="hljs-title class_">Grown</span>.<span class="hljs-property">argv</span>.<span class="hljs-property">_</span> = [<span class="hljs-string">&#x27;example&#x27;</span>];
<span class="hljs-title class_">Grown</span>.<span class="hljs-property">argv</span>.<span class="hljs-property">raw</span> = [<span class="hljs-string">&#x27;ls&#x27;</span>, <span class="hljs-string">&#x27;tasks&#x27;</span>];

<span class="hljs-comment">// take the first non-param value</span>
<span class="hljs-keyword">const</span> taskName = <span class="hljs-title class_">Grown</span>.<span class="hljs-property">argv</span>.<span class="hljs-property">_</span>.<span class="hljs-title function_">shift</span>();

<span class="hljs-comment">// invoke raw args and then run</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Grown</span>.<span class="hljs-property">CLI</span>.<span class="hljs-title function_">start</span>(taskName);

<span class="hljs-comment">// these tasks are invoked synchronously</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Grown</span>.<span class="hljs-property">CLI</span>.<span class="hljs-title function_">run</span>(taskName);
</code></pre>
<blockquote>
<p>Use this technique if you want to define your own <code>CLI</code> behavior, etc.</p>
</blockquote>
<hr>
<h2 id="how-it-works">How it works?</h2>
<p>Task files are defined as modules, e.g. <code>tasks/words.js</code></p>
<pre class="hljs"><code class="lang-js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">USAGE_INFO</span> = <span class="hljs-string">`

  It will print messages

  Given any arguments, this task will print them
  back as they were received, or reversed, etc.

  --mirror   Invert whole output before print
  --reverse  Invert words before print

  Examples:
    node script.js example hello world

`</span>;

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">description</span>: <span class="hljs-variable constant_">USAGE_INFO</span>,
  <span class="hljs-title function_">callback</span>(<span class="hljs-params">Grown</span>) {
    <span class="hljs-keyword">const</span> words = <span class="hljs-title class_">Grown</span>.<span class="hljs-property">argv</span>.<span class="hljs-property">_</span>.<span class="hljs-title function_">slice</span>();

    <span class="hljs-keyword">if</span> (!words.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Missing words&#x27;</span>);
    }

    <span class="hljs-keyword">let</span> output = words.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27; &#x27;</span>);

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Grown</span>.<span class="hljs-property">argv</span>.<span class="hljs-property">flags</span>.<span class="hljs-property">mirror</span>) {
      output = output.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>);
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Grown</span>.<span class="hljs-property">argv</span>.<span class="hljs-property">flags</span>.<span class="hljs-property">reverse</span>) {
      output = words.<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27; &#x27;</span>);
    }

    <span class="hljs-title class_">Grown</span>.<span class="hljs-property">Logger</span>.<span class="hljs-title function_">message</span>(output);
  },
};
</code></pre>
<p>Now you can invoke this task using <code>grown words</code> or <code>node script.js words</code> depending on your installation.</p>
<p>Formatting for task descriptions is enouraged to have its body indented with two spaces, to help readability.</p>
<p>See: <a href="https://github.com/grownjs/grown/tree/master/packages/cli/bin/tasks">built-in tasks</a> from CLI module</p>
<hr>
<h3 id="public-methods-var-static-var">Public methods <var>static</var></h3>
<ul>
<li><code>start([taskName])</code> &mdash; Invoke a single task by name, otherwise it&#39;ll list them all.
Additional args after <code>--</code> are executed as a shell command, returns a promise.</li>
<li><code>run(taskName)</code> &mdash; Invoke a single task by name, returns the task&#39;s <code>callback</code> result.</li>
</ul>
<h3 id="private-props-var-static-var">Private* props <var>static</var></h3>
<ul>
<li><code>_start</code> &mdash; Initialization date, e.g. <code>new Date()</code>.</li>
<li><code>_tasks</code> &mdash; Collected tasks by name.</li>
</ul>
<h3 id="private-methods-var-static-var">Private* methods <var>static</var></h3>
<ul>
<li><code>_findAvailableTasks()</code> &mdash; Scan and register file tasks once.</li>
<li><code>_findApplication()</code> &mdash; Scan for a initialization script.</li>
<li><code>_collectTasks(...fromDirs)</code> &mdash; Scan and return file tasks from given directories.</li>
<li><code>_showTasks([taskName])</code> &mdash; Test and <code>run</code> if the given <code>taskName</code> is registered. Returns a promise if it exists.</li>
<li><code>_showHelp([taskName])</code> &mdash; Display the usage info for a the given <code>taskName</code>.</li>
<li><code>_onError(errObj)</code> &mdash; Default error handler.</li>
<li><code>_onExit(statusCode)</code> &mdash; Default exit handler.</li>
<li><code>_exec(argv, callback)</code> &mdash; Invoke a shell command from the given <code>argv</code>, then <code>callback</code> when finished.</li>
</ul>
<hr>
<p>âž¯ Next: <a href="./docs/extensions/conn">Extensions &rangle; Conn</a></p>

        </main>
      </div>
      <aside class="inverted" id="sidebar">
        <div class="body">
          <h1>
            <a href=".">Grown</a>
          </h1>
          <p>Experimental DSL for web-apps</p>
          <div class="sp"><a href="http://badge.fury.io/js/grown" target="_blank"><img src="//badge.fury.io/js/grown.svg"></a><a href="//codecov.io/gh/grownjs/grown" target="_blank"><img src="//codecov.io/gh/grownjs/grown/branch/master/graph/badge.svg"></a><a href="//github.com/grownjs/grown/actions" target="_blank"><img src="//github.com/grownjs/grown/workflows/build/badge.svg"></a></div>
          <ul class="mt reset">
            <li>
              <h3 class="reset">APIs</h3>
              <ul class="pl reset">
                <li>
                  <a href=".">Installation</a>
                </li>
                <li>
                  <a exact="true" href="./docs">The interface</a>
                </li>
                <li>
                  <a href="./docs/command-line">Command line</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Add-ons</h3>
              <ul class="pl reset">
                <li>
                  <a aria-current="page" href="./docs/extensions">Extensions</a>
                  <ul class="pl reset">
                    <li>
                      <a href="./docs/extensions/access">Access</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/bud">Bud</a>
                    </li>
                    <li>
                      <a aria-current="page" href="./docs/extensions/cli">CLI</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/conn">Conn</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/graphql">GraphQL</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/grpc">GRPC</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/logger">Logger</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/model">Model</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/render">Render</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/repl">REPL</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/router">Router</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/server">Server</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/session">Session</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/static">Static</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/test">Test</a>
                    </li>
                    <li>
                      <a href="./docs/extensions/upload">Upload</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="./docs/connection">Connection</a>
                </li>
                <li>
                  <a href="./docs/middlewares">Middlewares</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Data-layer</h3>
              <ul class="pl reset">
                <li>
                  <a href="./docs/database">Models</a>
                </li>
                <li>
                  <a href="./docs/validation">Schemas</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Controllers</h3>
              <ul class="pl reset">
                <li>
                  <a href="./docs/controllers">Web</a>
                </li>
                <li>
                  <a href="./docs/controllers/grpc">GRPC</a>
                </li>
                <li>
                  <a href="./docs/controllers/graphql">GraphQL</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Unit-testing</h3>
              <ul class="pl reset">
                <li>
                  <a href="./docs/testing">Server</a>
                </li>
                <li>
                  <a href="./docs/testing/schema">Schema</a>
                </li>
                <li>
                  <a href="./docs/testing/handlers">Handlers</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </aside>
    </div>
    <script>window.__runkit__ = {"preamble":{"contents":"const fs = require('fs');\nconst assert = require('assert'); // eslint-disable-line\n\nfs.mkdirSync('./tasks');\nfs.writeFileSync('./tasks/example.js',\n  `module.exports = {\n    description: 'Example task',\n    callback() {\n      console.log('It works.')\n    },\n  };`);\n\nconst stripAnsi = require('strip-ansi');\n\nconst toString = value => String(Buffer.from(value));\nconst normalizeText = msg => stripAnsi(msg.replace(/[\\r\\n\\b]/g, ''));\n\nprocess.stdout.write = msg => console.log(normalizeText(toString(msg)));\n"}};</script>
    <script src="//embed.runkit.com"></script>
    <script src="scripts.js"></script>
  </body>
</html>