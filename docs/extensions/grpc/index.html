<!DOCTYPE html>
<html>
  <head>
    <base href="/grown">
    <meta lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no"><!--[if lt IE 9]>
    <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <script src="https://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script><![endif]-->
    <title>Grown // GRPC</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/highlight.js/styles/default.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sorts+Mill+Goudy">
  </head>
  <body class="reset">
    <main id="wrapper">
      <div class="body" id="content">
        <main><a id="menu" href="./docs/extensions/grpc/#sidebar">&#9776;</a>
          <h1>GRPC <small><a href="//github.com/pateketrueke/grown/blob/master/website/src/pages/docs/extensions/grpc.md" target="_blank">✎</a></small></h1><p>Setup micro-services talking through gRPC calls.</p>
<pre class="hljs"><code class="lang-js"><span class="hljs-comment">/* @runkit */</span>
<span class="hljs-comment">// register extension</span>
<span class="hljs-keyword">const</span> GRPC = Grown.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">'@grown/grpc'</span>));

<span class="hljs-comment">// ./index.proto</span>
<span class="hljs-comment">// syntax = "proto3";</span>
<span class="hljs-comment">// package API;</span>
<span class="hljs-comment">// service Test {</span>
<span class="hljs-comment">//   rpc is(Input) returns (Output) {}</span>
<span class="hljs-comment">// }</span>
<span class="hljs-comment">// message Input {</span>
<span class="hljs-comment">//   int32 truth = 1;</span>
<span class="hljs-comment">// }</span>
<span class="hljs-comment">// message Output {</span>
<span class="hljs-comment">//   string reveal = 1;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// ./handlers/Test/is/index.js</span>
<span class="hljs-comment">// module.exports = function ({ request }) {</span>
<span class="hljs-comment">//   return {</span>
<span class="hljs-comment">//     reveal: request.truth === 42,</span>
<span class="hljs-comment">//   };</span>
<span class="hljs-comment">// };</span>

<span class="hljs-keyword">const</span> Gateway = Grown.GRPC.Gateway({
  <span class="hljs-attr">include</span>: [
    GRPC.Loader.scan(<span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/index.proto`</span>),
  ],
});

<span class="hljs-keyword">const</span> API = Grown.load(<span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/handlers`</span>);
<span class="hljs-keyword">const</span> gateway = Gateway.setup(API, {
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10</span>,
}).start();

gateway.API.Test.is({ <span class="hljs-attr">truth</span>: <span class="hljs-number">42</span> })
  .then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'GOT:'</span>, result);
  });
</code></pre>
<h2 id="loader">Loader</h2>
<h3 id="public-methods-var-static-var">Public methods <var>static</var></h3>
<ul>
<li><code>scan(file[, options])</code> &mdash; Returns a mapping of all services found in the given <code>file</code>, <code>options</code> are given to <code>@grpc/proto-loader</code> when loading the file.</li>
</ul>
<hr>
<h2 id="gateway">Gateway</h2>
<h3 id="public-methods-var-static-var">Public methods <var>static</var></h3>
<ul>
<li><p><code>setup(controllers[, options])</code> &mdash; Returns a gateway instance with services and controllers merged. Invoke them as <code>map.send&lt;Service&gt;(...)</code> or as <code>map.Service.method({ ... })</code> indistinctly.</p>
<p>Supported options are:</p>
<ul>
<li><code>hostname(serviceName)</code> &mdash; Function, used to determine a host for service registration, fallback to <code>0.0.0.0</code> otherwise.</li>
<li><code>timeout</code> &mdash; Number, timeout in seconds for gRPC deadline option; default to <code>undefined</code>.</li>
<li><code>port</code>  &mdash; Number, custom port for service registration; default to <code>50051</code>.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Calls to <code>hostname(...)</code> would return a port too, in such case is preferred and used instead.</p>
</blockquote>
<h3 id="private-methods-var-static-var">Private* methods <var>static</var></h3>
<ul>
<li><code>_callService(options, client, method, data)</code> &mdash; Wrap used methods when calling services.</li>
<li><code>_getService(name, controller)</code> &mdash; Decorate all methods on given handlers.</li>
<li><code>_onError(e)</code> &mdash; Decorate errors thrown by calling services.</li>
</ul>
<hr>
<p>➯ Next: <a href="./docs/extensions/logger">Extensions &rangle; Logger</a></p>

        </main>
      </div>
      <aside class="inverted" id="sidebar">
        <div class="body">
          <h1><a href="/grown/">Grown</a>
          </h1>
          <p>Experimental DSL for web-apps</p>
          <div class="sp"><a href="//travis-ci.org/pateketrueke/grown" target="_blank"><img src="//api.travis-ci.org/pateketrueke/grown.svg"></a><a href="//codecov.io/gh/pateketrueke/grown" target="_blank"><img src="//codecov.io/gh/pateketrueke/grown/branch/master/graph/badge.svg"></a></div>
          <ul class="mt reset">
            <li>
              <h3 class="reset">APIs</h3>
              <ul class="pl reset">
                <li><a href="/grown/">Installation</a>
                </li>
                <li><a href="/grown/docs">The interface</a>
                </li>
                <li><a href="/grown/docs/command-line">Command line</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Add-ons</h3>
              <ul class="pl reset">
                <li><a href="/grown/docs/extensions">Extensions</a>
                  <ul class="pl reset">
                    <li><a href="/grown/docs/extensions/access">Access</a>
                    </li>
                    <li><a href="/grown/docs/extensions/bud">Bud</a>
                    </li>
                    <li><a href="/grown/docs/extensions/cli">CLI</a>
                    </li>
                    <li><a href="/grown/docs/extensions/conn">Conn</a>
                    </li>
                    <li><a href="/grown/docs/extensions/graphql">GraphQL</a>
                    </li>
                    <li><strong><a class="here" href="/grown/docs/extensions/grpc">GRPC</a></strong>
                    </li>
                    <li><a href="/grown/docs/extensions/logger">Logger</a>
                    </li>
                    <li><a href="/grown/docs/extensions/model">Model</a>
                    </li>
                    <li><a href="/grown/docs/extensions/parsers">Parsers</a>
                    </li>
                    <li><a href="/grown/docs/extensions/render">Render</a>
                    </li>
                    <li><a href="/grown/docs/extensions/repl">REPL</a>
                    </li>
                    <li><a href="/grown/docs/extensions/router">Router</a>
                    </li>
                    <li><a href="/grown/docs/extensions/schema">Schema</a>
                    </li>
                    <li><a href="/grown/docs/extensions/server">Server</a>
                    </li>
                    <li><a href="/grown/docs/extensions/session">Session</a>
                    </li>
                    <li><a href="/grown/docs/extensions/static">Static</a>
                    </li>
                    <li><a href="/grown/docs/extensions/tarima">Tarima</a>
                    </li>
                    <li><a href="/grown/docs/extensions/test">Test</a>
                    </li>
                    <li><a href="/grown/docs/extensions/upload">Upload</a>
                    </li>
                  </ul>
                </li>
                <li><a href="/grown/docs/connection">Connection</a>
                </li>
                <li><a href="/grown/docs/middlewares">Middlewares</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Data-layer</h3>
              <ul class="pl reset">
                <li><a href="/grown/docs/database">Models</a>
                </li>
                <li><a href="/grown/docs/validation">Schemas</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Controllers</h3>
              <ul class="pl reset">
                <li><a href="/grown/docs/controllers">Web</a>
                </li>
                <li><a href="/grown/docs/controllers/grpc">GRPC</a>
                </li>
                <li><a href="/grown/docs/controllers/graphql">GraphQL</a>
                </li>
              </ul>
            </li>
            <li>
              <h3 class="reset">Unit-testing</h3>
              <ul class="pl reset">
                <li><a href="/grown/docs/testing">Server</a>
                </li>
                <li><a href="/grown/docs/testing/schema">Schema</a>
                </li>
                <li><a href="/grown/docs/testing/handlers">Handlers</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </aside>
    </main>
    <script>window.__runkit__ = {"preamble":"require('@grpc/proto-loader');\nrequire('grpc');\nconst fs = require('fs');\nconst assert = require('assert');\nfs.mkdirSync('./handlers');\nfs.mkdirSync('./handlers/Test');\nfs.mkdirSync('./handlers/Test/is');\nfs.writeFileSync('./handlers/Test/is/index.js', `\n  module.exports = function ({ request }) {\n    return { reveal: request.truth === 42 };\n  };\n`);\nfs.writeFileSync('./index.proto', `\n  syntax = \"proto3\";\n  package API;\n  service Test {\n    rpc is(Input) returns (Output) {}\n  }\n  message Input {\n    int32 truth = 1;\n  }\n  message Output {\n    string reveal = 1;\n  }\n`);\nconst Grown = require('@grown/bud')();\n"};</script>
    <script src="https://embed.runkit.com"></script>
    <script src="scripts.js"></script>
  </body>
</html>