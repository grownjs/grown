version: "3.4"

services:
  chrome:
    command: google-chrome --start-fullscreen http://web:9505/browser/connect
    image: martinsthiago/chrome:64.0.3282.186
  nginx:
    build:
      context: .
      dockerfile: ./web/Dockerfile.nginx
    image: pateketrueke/nginx
    command: "bash -c 'nginx; tail -f /var/log/nginx/error.log'"
    depends_on:
      - app
  db:
    image: postgres:11
    volumes:
     - ./docker/postgres:/docker-entrypoint-initdb.d
    environment:
      POSTGRES_DB: ${DB_NAME:-user_dev}
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-*secret*}
  app:
    build:
      context: .
      dockerfile: ./web/Dockerfile.app
    image: pateketrueke/web
    depends_on:
      - db
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      DB_NAME: ${DB_NAME:-user_dev}
      DB_PORT: ${DB_PORT:-5432}
      DB_HOST: ${DB_HOST:-db}
      USER_PORT: ${USER_PORT:-50051}
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-*secret*}
      WITHOUT_SEEDS: ${WITHOUT_SEEDS}
      REMOVE_LOG: ${REMOVE_LOG}

networks:
  default:
    driver: bridge
