#!/bin/sh
':' // ; exec "$(command -v nodejs || command -v node)" "$0" "$@"
;

'use strict';

/* eslint-disable global-require */

const $ = require('wargs')(process.argv.slice(2), { asArray: true });

/* istanbul ignore else */
if (process.env.CI) {
  process.env.NODE_ENV = 'ci';
}

const thisPkg = require('../package.json');
const cleanStack = require('clean-stack');
const chalk = require('chalk');

const _ = require('./lib/_util');

const _task = $.data.shift();
const _node = chalk.gray(`node ${process.version}`);
const _name = chalk.green(`${thisPkg.name} v${thisPkg.version}`);

_.echo(`${_name} ${_node}\n`);

try {
  require(`./lib/${_task === 'repl' || _task === 'start' ? _task : 'gen'}`);
} catch (e) {
  _.echo(chalk.red(($.flags.debug && cleanStack(e.stack)) || e.message), '\n');
  _.die(1);
}
