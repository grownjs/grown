#!/bin/sh
':' // ; exec "$(command -v nodejs || command -v node)" "$0" "$@"
;

'use strict';

/* eslint-disable global-require */

process.env.NODE_ENV = process.env.NODE_ENV || 'dev';

const IS_DEBUG = process.argv.indexOf('--debug') > -1;
const IS_DEV = process.env.NODE_ENV === 'dev';

/* istanbul ignore else */
if (IS_DEBUG) {
  require('debug').enable('homegrown,homegrown:*');
}

/* istanbul ignore else */
if (IS_DEV) {
  require('source-map-support').install();
}

const thisPkg = require('../package.json');
const cleanStack = require('clean-stack');

const bin = Object.keys(thisPkg.bin)[0];
const args = process.argv.slice(2);
const cmd = args.shift();

const color = require('cli-color');

const _ = require('./lib/_util');

if (!cmd) {
  _.echo(color.yellow(`Usage: ${bin} gen|repl|start\n`));
  _.die(1);
}

switch (cmd) {
  case 'start':
  case 'repl':
  case 'gen':
    try {
      require(`./lib/${cmd}`);
    } catch (e) {
      _.echo(color.red((IS_DEBUG && cleanStack(e.stack)) || e.message), '\n');
      _.die(200);
    }
    break;

  default:
    _.echo(color.red(`Unknown task '${cmd}'\n`));
    _.die(100);
}
