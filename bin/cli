#!/bin/sh
':' // ; exec "$(command -v nodejs || command -v node)" "$0" "$@"
;

'use strict';

/* eslint-disable global-require */

const IS_DEBUG = process.argv.indexOf('--debug') > -1;

const thisPkg = require('../package.json');
const cleanStack = require('clean-stack');

const bin = Object.keys(thisPkg.bin)[0];
const args = process.argv.slice(2);
const cmd = args.shift();

const chalk = require('chalk');

const _ = require('./lib/_util');

if (!cmd) {
  _.echo(chalk.yellow(`Usage: ${bin} gen|repl|start\n`));
  _.die(1);
}

switch (cmd) {
  case 'start':
  case 'repl':
  case 'gen':
    try {
      require(`./lib/${cmd}`);
    } catch (e) {
      _.echo(chalk.red((IS_DEBUG && cleanStack(e.stack)) || e.message), '\n');
      _.die(200);
    }
    break;

  default:
    _.echo(chalk.red(`Unknown task '${cmd}'\n`));
    _.die(100);
}
